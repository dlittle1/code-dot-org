#!/usr/bin/env ruby
require_relative '../mailing-common/mailing-list-utils'
require 'set'

def query_with_location(base_query, city_and_state_list)
  location_query = city_and_state_list.map do |city, state|
    "(location_state_s:\"#{state}\" && location_city_s:\"#{city}\") || (create_ip_state_s:\"#{state}\" && create_ip_city_s:\"#{city}\")"
  end.join(" || ")

  "(#{base_query}) && (#{location_query})"
end

def query_teachers_with_location(city_and_state_list)
  base_query =
    # BringToSchool2013
    '(kind_s:BringToSchool2013 && role_s:teacher) || ' +

    # Petition teachers
    '(kind_s:Petition && role_s:educator) || ' +

    # Past 2013 organizers
    '(kind_s:CSEdWeekEvent2013 && role_s:teacher) || ' +

    # Past 2014 organizers
    'kind_s:HocSignup2014 || ' +

    # HOC 2015 organizers
    'kind_s:HocSignup2015 || ' +

    # Code studio teachers
    '(kind_s:user && role_s:teacher)'

  query_with_location(base_query, city_and_state_list)
end

nyc_cities = {
  'Brooklyn' => 'New York',
  'Queens' => 'New York',
  'Bronx' => 'New York',
  'Staten Island' => 'New York',
  'New York' => 'New York'
}

puts query_teachers_with_location(nyc_cities)
