#!/usr/bin/env ruby
require_relative '../mailing-common/mailing-list-utils'
require 'set'

def query_with_location(base_query, city, state)
  query = "(#{base_query}) && ((location_state_s:\"#{state}\" && location_city_s:\"#{city}\") || (create_ip_state_s:\"#{state}\" && create_ip_city_s:\"#{city}\"))"
  results = query_subscribed_contacts(q: query)

  puts "#{results.length} results"
  results
end

def query_teachers_with_location(city, state)
  base_query =
    # BringToSchool2013
    '(kind_s:BringToSchool2013 && role_s:teacher) || ' +

    # Petition teachers
    '(kind_s:Petition && role_s:educator) || ' +

    # Past 2013 organizers
    '(kind_s:CSEdWeekEvent2013 && role_s:teacher) || ' +

    # Past 2014 organizers
    'kind_s:HocSignup2014 || ' +

    # HOC 2015 organizers
    'kind_s:HocSignup2015 || ' +

    # Code studio teachers
    '(kind_s:user && role_s:teacher)'

  query_with_location(base_query, city, state)
end

results = query_teachers_with_location('Chicago', 'IL')
export_contacts_to_csv results, "Teachers_#{region_name}.csv"
